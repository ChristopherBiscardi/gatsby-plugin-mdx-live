---
title: 'Programmatically Creating Pages'
---

# Programmatically Creating Pages

Adding `gatsby-mdx` to your Gatsby website is extremely fast and easy, but sometimes you want to be able to programmatically create pages that live outside of `src/pages/`.

For instance, let's say you have a Gatsby website, and you want to add support for MDX so you can start that blog you've been putting off forever. The posts will live in `content/posts/`.

You can do this with the help of `gatsby-source-filesystem`, and some calls to `createPages` in `gatsby-node.js`. Let's dive in.

<h3>Sections</h3>

<ul>
  <li>
    <a href='#install-dependencies'>Install Dependencies</a>
  </li>
  <li>
    <a href='#edit-your-gatsby-config'>Edit Your gatsby-config.js</a>
  </li>
  <li>
    <a href='#add-mdx-files'>Add MDX Files</a>
  </li>
  <li>
    <a href='#generate-slugs'>Generate Slugs</a>
  </li>
  <li>
    <a href='#query-for-mdx-files'>Query For MDX Files</a>
  </li>
  <li>
    <a href='#create-pages'>Create Pages From Your Query</a>
  </li>
  <li>
    <a href='#make-a-template'>Make A Template For Your Blog Posts</a>
  </li>
  <li>
    <a href='#bonus'>Bonus: Make a Blog Index</a>
  </li>
</ul>
<br />

---

<h2 id='install-dependencies'>Install Dependencies</h2>

You need to install a few things to get started including `gatsby-mdx`, `@mdx-js/tag`, `@mdx-js/mdx`, and `gatsby-source-filesystem`.

From the root of your Gatsby project run:

```sh
npm install gatsby-mdx @mdx-js/tag @mdx-js/mdx gatsby-source-filesystem
```

<br />
<hr />

<h2 id='edit-your-gatsby-config'>Edit Your `gatsby-config.js`</h2>

To let Gatsby know that you'll be working with `MDX` files you need to add `gatsby-mdx` to the plugins array in your `gatsby-config.js` file.

```javascript
/* gatsby-config.js */

module.exports = {
  plugins: [
    /* 1) this adds support for *.mdx files in gatsby */
    'gatsby-mdx',

    /*
     * 2) this adds a collection called "posts"
     * that looks for files in `content/posts/`
     */
    {
      resolve: 'gatsby-source-filesystem',
      options: {
        name: 'posts',
        path: `${__dirname}/content/posts/`,
      },
    },
  ],
};
```

Here you're telling Gatsby "Look in a folder called `content/posts` that's located in the root of my project. Make any file inside accessible through a GraphQL query, add a property called `sourceInstanceName` and set its value to `posts`"

You can read about [gatsby-source-filesystem](https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-source-filesystem#readme) if you'd like to learn more.

<br />
<hr />

<h2 id='add-mdx-files'>Add MDX Files</h2>

Before you can write any GraphQL queries, and programmatically create pages, you need to add some content.

In your terminal run the following commands:

```sh
mkdir -p content/posts
```

```sh
touch content/posts/blog-{1,2}.mdx
```

Open up each of the files you just created and add some content.

```md
---
title: 'Blog Post 1'
---

Trying out MDX
```

<br />

```md
---
title: 'Blog Post 2'
---

Gatsby is the best
```

<br />
<hr />

<h2 id='generate-slugs'>Generate Slugs</h2>

Because you're programmatically creating pages, you need to construct the URL yourself.

```javascript
// in gatsby-node.js

const { createFilePath } = require('gatsby-source-filesystem');

exports.onCreateNode = ({ node, actions, getNode }) => {
  const { createNodeField } = actions;

  if (node.internal.type === 'Mdx') {
    const value = createFilePath({ node, getNode });

    createNodeField({
      name: 'slug' /* 1) this is the name of the field you are adding */,
      node /* 2) this node refers to each individual mdx file */,
      value: `/blog${value}`,
      /*
       * 3) this will result in:
       * blog-1.mdx => "localhost:8000/blog/blog-1/"
       * blog-2.mdx => "localhost:8000/blog/blog-2/"
       *
       * 4) it also takes care of something like content/posts/example/index.mdx
       * example/index.mdx => "localhost:8000/blog/example/"
       * this comes in handy when you have components or assets that you want to
       * collocate with your mdx files
       *
       */
    });
  }
};
```

Here is a link to the Gatsby docs for [onCreateNode](https://www.gatsbyjs.org/docs/node-apis/#onCreateNode), as well as [createFilePath](https://www.gatsbyjs.org/packages/gatsby-source-filesystem/?=gatsby-source#createfilepath) from `gatsby-source-filesystem`.

<br />
<hr />

<h2 id='query-for-mdx-files'>Query For MDX Files</h2>

Before you can programmatically create pages from your `*.mdx` files, you need to put together a GraphQL query. Start up Gatsby in development mode, and open up GraphiQL.

In the root of your Gatsby project run:

```sh
gatsby develop
```

Then, in your browser open up <a href='https://localhost:8000/___graphql' target='_blank'>https://localhost:8000/\_\_\_graphql</a> and paste the following into GraphiQL:

```graphql
query {
  allMdx {
    edges {
      node {
        id
        fields {
          # this is the slug field you created in the last section
          slug
        }
      }
    }
  }
}
```

This is the basic query you need to create your mdx pages, but you can edit and add to this to fit your needs.

<br />
<hr />

<h2 id="create-pages">Create Pages From Your Query</h2>

```javascript
// in gatsby-node.js
const path = require('path');

exports.createPages = ({ graphql, actions }) => {
  /* 1) Destructure the createPage function from the actions object */
  const { createPage } = actions;

  /* 2) The following is the Graphql query you just constructed wrapped in a Promise */
  return new Promise((resolve, reject) => {
    resolve(
      graphql(
        `
          {
            allMdx {
              edges {
                node {
                  id
                  fields {
                    slug
                  }
                }
              }
            }
          }
        `,
      ).then(result => {
        /* 3) Check for errors, print to console, and reject the promise */
        if (result.errors) {
          console.error(result.errors);
          reject(result.errors);
        }

        /* 4) Iterate over the edges in allMdx */
        result.data.allMdx.edges.forEach(({ node }) => {
          /* 5) createPage is called on each of the edges */
          createPage({
            /* 6) This is the url for the newly created page */
            path: node.fields.slug,
            /*
             * 7) This is the path to the component you want to use as a layout.
             * You will make this file next.
             */
            component: path.resolve(`./src/components/posts-page-layout.js`),

            /*
             * 8) You pass the id through context
             * so you can access it as a GraphQL variable
             */
            context: { id: node.id },
          });
        });
      }),
    );
  });
};
```

Here is a link to the [createPages](https://www.gatsbyjs.org/docs/node-apis/#createPages) documentation in Gatsby.

<br />
<hr />

<h2 id="make-a-template">Make A Template For Your Blog Posts</h2>

If you tried to look at your Gatsby website as it was right now, it wouldn't look like anything changed. Make a file called `posts-page-layout.js` in `src/components`

```jsx
// src/components/posts-page-layout.js
import React from 'react';
import { graphql } from 'gatsby';
import MDXRenderer from 'gatsby-mdx/mdx-renderer';

function PageTemplate({ data: { mdx } }) {
  return (
    <div>
      <h1>{mdx.frontmatter.title}</h1>
      {/* 1) You always need to wrap your mdx.code.body in MDXRenderer */}
      <MDXRenderer>{mdx.code.body}</MDXRenderer>
    </div>
  );
}

/*
 *
 * 2) `id` is passed in through context but to access it you need to declare its type
 * at the top of your query.
 *
 * 3) Normally it's a good idea to give a name to your queries
 * but because of the way gatsby-mdx inserts the queries,
 * you'll get an error if you name a query for a programattically created page.
 *
 */
export const pageQuery = graphql`
  query($id: String) {
    mdx(id: { id: $id }) {
      id
      frontmatter {
        title
      }
      code {
        body
      }
    }
  }
`;
```

<br />
<hr />

<h2 id="bonus">Bonus: Make a Blog Index</h2>

```jsx
// src/pages/index.js
import React from 'react'
import { Link, graphql } from 'gatsby'

const BlogIndex = ({ data }) => {
  const { edges: posts } = data.allMdx

  return (
    <div>
      <h1>Awesome MDX Blog</h1>

      <ul>
        {posts.map(({ node: post }) => (
          <li key={post.id}>
            <Link to={post.fields.slug}>
              <h2>{post.frontmatter.title}</h2>
            </Link>
            <p>{post.excerpt}</p>
          </li>
        ))
      </ul>
    </div>
  )
}

export const pageQuery = graphql`
  query blogIndex {
    allMdx {
      edges {
        node {
          id
          excerpt
          frontmatter {
            title
          }
          fields {
            slug
          }
        }
      }
    }
  }
`

export default BlogIndex

```

Now you have all the pieces you need to programmatically create pages with Gatsby and `gatsby-mdx`. Check out our other guides to find out more about all of the cool stuff you can do with `gatsby-mdx`.
